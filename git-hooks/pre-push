#!/usr/bin/env node
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

const path = require('path');
const { execSync } = require('child_process');

// Get the project root directory
const PROJECT_ROOT = execSync('git rev-parse --show-toplevel', { encoding: 'utf8' }).trim();
const GIT_HOOKS_DIR = path.join(PROJECT_ROOT, 'git-hooks');

// Change to project root directory
process.chdir(PROJECT_ROOT);

const run = require(path.join(GIT_HOOKS_DIR, 'scripts/utils/run')).run;

console.log('üîç Running pre-push validations...\n');

function runAll() {
  const tasks = [
    {
      name: 'Copyright Header Check',
      command: `node ${path.join(GIT_HOOKS_DIR, 'scripts/check-license.js')}`,
    },
    {
      name: 'Go Format Check',
      command: 'go fmt ./...',
    },
    {
      name: 'Go Vet Check',
      command: 'go vet ./...',
    },
    {
      name: 'Go Build Check',
      command: 'go build ./...',
    },
    {
      name: 'Go Test Suite',
      command: 'go test ./test/... -v',
    }
  ];

  for (let i = 0; i < tasks.length; i++) {
    run(tasks[i]);
  }
}

runAll();